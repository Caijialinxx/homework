<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="bg"><div class="bgMask"></div></div>
  <div id="wrapper"></div>
  <script>
    keys=[
      ['q','w','e','r','t','y','u','i','o','p'],
      ['a','s','d','f','g','h','j','k','l'],
      ['z','x','c','v','b','n','m']
    ]
    hash={
      'q':"", 'w':"w3.org", 'e':"", 'r':"ruanyifeng.com", 't':"css-tricks.com", 
      'y':"youtube.com", 'u':"", 'i':"iconfont.cn", 'o':"", 'p':"processon.com", 
      'a':"amazon.com", 's':"sm.ms", 'd':"dribbble.com", 'f':"facebook.com", 
      'g':"github.com/Caijialinxx", 'h':"", 'j':"jsbin.com", 'k':"", 'l':"", 
      'z':"zhihu.com", 'x':"xiedaimala.com", 'c':"caijialinxx.github.io", 
      'v':"", 'b':"baidu.com", 'n':"", 'm':"developer.mozilla.org/zh-CN/"
    }
    
    //取出localStorage中对应的哈希表，如果存在则赋值给变量hash，实现刷新页面可以取得最新的哈希表
    hashInLocalStorage = JSON.parse(localStorage.getItem('newHash')||null)
    if(hashInLocalStorage){
      hash = hashInLocalStorage
    }

    document.onkeypress=function(e){
      openKeyWebsite(e.key)
    }

    for (i = 0; i < keys.length; i++) {
      div = document.createElement('div')
      wrapper.appendChild(div)
      for (j = 0; j < keys[i].length; j++) {
        kbd = document.createElement('kbd')
        div.appendChild(kbd)
        kbd.textContent = keys[i][j]
        
        btn = document.createElement('button')
        kbd.appendChild(btn)
        btn.textContent = "E"
        btn.id = keys[i][j]

        //添加鼠标点击按键事件，使其实现啊与键盘按键打开快捷网址同样的效果
        kbd.onclick = function(e){
          openKeyWebsite(e.target.firstChild.data)
        }
        //当点击<button>"E"时进行自定义快捷网址编辑
        btn.onclick = function (e) {
          newSite = prompt("请自定义【" + e.target.id.toUpperCase() + "】键的快捷网址：", hash[e.target.id])
          if (newSite == "") {
            alert("未输入自定义快捷网址，您可以随时重新自定义")
            hash[e.target.id]=newSite;
            localStorage.setItem('newHash', JSON.stringify(hash))
          }
          else if (newSite == null) {
            if(hash[e.target.id]){
              alert("您取消了自定义，将会继续使用默认快捷网址！")
            }
          }
          else {
            alert("自定义成功！您设置【" + e.target.id.toUpperCase() + "】键的新快捷网址是 http://" + newSite)
            hash[e.target.id]=newSite;
            localStorage.setItem('newHash', JSON.stringify(hash))
          }
        }
      }
    }
    function openKeyWebsite(key){
      //加入此条件判断是为了防止点击<button>"E"时，函数误以为需要查询hash["E"]并执行后续操作。
      if (key !== "E") {
        website = hash[key]
        if (website) {
          window.open("http://" + website, "_blank")
        }
        else {
          alert("您未定义【" + key.toUpperCase() + "】键的快捷网址")
        }
      }
    }
  </script>
</body>
</html>